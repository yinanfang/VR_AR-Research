{\rtf1\ansi\ansicpg1252 {\fonttbl\f0\froman\fcharset0 Garamond;\f1\froman\fcharset0 Garamond,Italic;\f2\froman\fcharset0 Times New Roman;\f3\fswiss\fcharset0 ArialBlack;\f4\froman\fcharset0 Times New Roman;\f5\froman\fcharset0 Times New Roman;\f6\fswiss\fcharset0 TrebuchetMS;\f7\ftech\fcharset0 Wingdings;\f8\froman\fcharset0 OCRAExtended;\f9\fswiss\fcharset0 TrebuchetMS,Bold;\f10\ftech\fcharset0 Wingdings2;\f11\fmodern\fcharset0 Courier;\f12\froman\fcharset0 BookAntiqua;\f13\fswiss\fcharset0 Arial;\f14\fswiss\fcharset0 Arial;\f15\fmodern\fcharset0 Courier;}{\colortbl\red0\green0\blue0;\red129\green129\blue129;\red0\green51\blue51;\red0\green102\blue102;\red0\green51\blue0;\red51\green51\blue51;}\pard\plain\ql\f0\fs20\cf0 {\fs72 HiBall-3000 Wide-Area Tracker\par }{\fs52 User Manual\par Software Revision 1.5.2\par }{\i\f1\fs32 Manual Revision F\par }{\fs36 1/7/02}\par {\b\f2\fs16 HiBall-3000 Tracker i 1/23/02\par }{\f3\fs48\cf1 Table of Contents\par }{\b\f2\fs24 1 Introduction.................................................. 1\par }{\i\f4\fs22 1.1 Overview of components................................ 1\par }{\b\f2\fs24 2 Installation .................................................... 2\par }{\i\f4\fs22 2.1 List of components ......................................... 2\par 2.2 Step 1 – Initial configuration and system test 3\par }{\f5\fs22 2.2.1 System Location............................... 3\par 2.2.2 Connections and Power Up.............. 4\par 2.2.3 Connecting the CIB, HiBall Sensor,\par and a beacon strip............................. 5\par 2.2.4 Initial System Test ........................... 6\par }{\i\f4\fs22 2.3 Step 2 – Configure Beacon Strips.................. 7\par }{\f5\fs22 2.3.1 Beacon Strip Installation .................. 7\par 2.3.2 Full Ceiling Test............................. 10\par }{\i\f4\fs22 2.4 Connecting additional HiBall sensors......... 12\par 2.5 Mounting HiBall sensors ............................. 12\par }{\b\f2\fs24 3 Operation ................................................... 12\par }{\i\f4\fs22 3.1 Running the HiBall Server........................... 12\par }{\f5\fs22 3.1.1 HiBall Server Control Panel........... 13\par 3.1.2 HiBall Tracker operation................ 17\par }{\i\f4\fs22 3.2 Running client applications ......................... 19\par }{\b\f2\fs24 4 Application Interface (VRPN) .................. 19\par }{\i\f4\fs22 4.1 VRPN ........................................................ 19\par }{\f5\fs22 4.1.1 Install VRPN Client Software........ 20\par 4.1.2 Writing a VRPN/HiBall client\par application...................................... 20\par 4.1.3 Coordinate Systems........................ 22\par 4.1.4 Quaternions .................................... 25\par 4.1.5 Using the Stylus..............................26\par 4.1.6 Sample VRPN client applications ..27\par }{\b\f2\fs24 5 Troubleshooting ......................................... 28\par }{\i\f4\fs22 5.1 Hardware problems......................................28\par 5.2 Error messages.............................................29\par 5.3 Tracking performance ..................................29\par 5.4 Support Contacts..........................................30\par }{\b\f2\fs24 6 Customizing the HiBall-3000 tracker ...... 30\par }{\i\f4\fs22 6.1 Changing the ceiling configuration..............30\par }{\f5\fs22 6.1.1 Running the ceiling map editor.......30\par 6.1.2 Considerations when changing the\par ceiling map .....................................35\par 6.1.3 Enabling the new ceiling map in the\par tracker configuration file ................37\par 6.1.4 Changing the Beacon Grid Spacing 38\par }{\i\f4\fs22 6.2 Customizing the HiBall Server.....................38\par }{\f5\fs22 6.2.1 Overview of configuration files......38\par 6.2.2 Changing the HiBall Sensor\par arrangement ....................................39\par 6.2.3 Changing configuration files ..........40\par }{\i\f4\fs22 6.3 Customizing Beacon Autocalibration...........41\par 6.4 Customizing Multimodel Switching..............43\par 6.5 Upgrading software......................................45\par }{\f5\fs22 6.5.1 Upgrading VRPN............................45\par 6.5.2 Upgrading HiBall tracker software.45}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 1\par }{\f6\fs44\cf2 1 Introduction\par }{\f5\fs24 The HiBall-3000 Wide Area Tracker is an optical, high-performance tracking\par system based on technology first developed by the Wide Area Tracker research\par group of the Computer Science Department at the University of North Carolina\par at Chapel Hill. The system provides a unique approach to high-performance\par tracking.\par }{\f7\fs16 q  }{\f5\fs24 The HiBall Tracker uses an }{\i\f4\fs24 inside-looking-out }{\f5\fs24 approach with sensors\par on the user (the object being tracked) and landmarks (Beacon Arrays)\par on the ceiling. This enables the system to scale to very large areas –\par upwards of 1600 square feet (148 square meters). It also provides\par unprecedented resolution and accuracy for position and orientation.\par }{\f7\fs16 q  }{\f5\fs24 A major design goal of the HiBall Tracker was low latency to prevent\par the ‘swimming’ associated with the lag between head motion and\par tracker update rate of most commercial trackers.\par }{\f7\fs16 q  }{\f5\fs24 An optical tracker is unaffected by metallic or acoustic interference.\par Furthermore, the accuracy and performance are uniform throughout the\par tracking area.\par This manual describes the design and operation of the HiBall-3000 tracker\par system. Additional information about the development of the HiBall Tracker\par and associated research is available on the UNC web site at\par }{\i\f4\fs22 http://www.cs.unc.edu/~tracker/\par }{\f5\fs24 A PDF version of this manual is also on the system software CD in the ‘doc’\par directory. You can download the latest version of Adobe Acrobat (a free PDF\par file reader) from }{\i\f4\fs24 http://www.adobe.com}{\f5\fs24 .\par }{\f6\fs32\cf3 1.1 Overview of components\par }{\f5\fs24 The HiBall-3000 Tracker System is a complete tracking solution. Figure 1\par shows its hardware components. These are:\par 1. The HiBall Sensors – lenses and photodiodes in a lightweight\par casing which view infrared LEDs in the Beacon Arrays\par 2. Beacon Arrays – strips of infrared LEDs mounted on the ceiling or\par some surface overhead\par 3. CIB – Interface unit connecting the HiBall Sensors and Beacon\par Arrays with the PC controller\par 4. PC – Dedicated PC provides the interface between the CIB and\par client applications via an Ethernet connection.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 2\par }{\b\f2 Figure 1 HiBall-3000 Wide Area Tracker System\par }{\f6\fs44\cf2 2 Installation\par }{\f5\fs24 The HiBall-3000 System was designed to be user installable and, in many\par common environments, requires no special modifications of the ceiling or\par tracking area.\par }{\f6\fs32\cf3 2.1 List of components\par }{\f5\fs24 A typical system includes the following components.\par }{\f7\fs16 q  }{\f5\fs24 Multiple Beacon Arrays (ceiling strips), power distribution boxes\par (PDBs), and cables.\par }{\f7\fs16 q  }{\f5\fs24 One CIB (Ceiling Interface Board) in box with power cord and EPP\par cable (IEEE 1284C), and ‘buttons’ parallel cable.\par }{\f7\fs16 q  }{\f5\fs24 One HiBall Server PC (Windows NT), with case, monitor, mouse and\par keyboard.\par }{\f7\fs16 q  }{\f5\fs24 1 or 2 HiBall Sensors and matching tether cables.\par }{\f7\fs16 q  }{\f5\fs24 HiBall software CD.\par }{\f7\fs16 q  }{\f5\fs24 A video camera for viewing LEDs\par In addition, a monitor/TV for viewing LEDs with the camera provided is useful\par for installation and troubleshooting. This is described further in Section 2.2.4.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 3\par }{\f6\fs32\cf3 2.2 Step 1 – Initial configuration and system test\par }{\f5\fs24 This section describes procedures for initial HiBall Tracker system installation,\par configuration, and system testing.\par }{\f6\fs28\cf4 2.2.1 System Location\par }{\f5\fs24 First, select the region you wish to track and the corresponding ceiling area –\par typically a little larger than the tracked region. (The range of angular tilt of the\par HiBall Sensor is somewhat limited near the edge of the Beacon Arrays. For a\par full angular range of motion we recommend extending the Beacon Arrays 2 ft.\par beyond the region to be tracked.)\par Note: You will need an appropriate ceiling structure on which to\par mount the Beacon Arrays. They are designed to be installed in two\par different ways. They can be attached, with no additional hardware,\par to the support lattice of a typical ‘drop’ ceiling. (The ends of the\par two-foot long individual strips slide between the ceiling tile and\par support lattice – see Figure 2.) Alternatively, each strip has\par mounting holes (visible in the figure near the ends of the strips) by\par which they can be attached to a solid surface.\par }{\b\f2 Figure 2 Beacon Arrays\par }{\f5\fs24 The CIB Box (Figure 3) connects to the parallel ports of the HiBall System PC.\par A cable from the CIB box connects to a Power Distribution Box (PDB) located\par next to the first Beacon array strip in the daisy chain of strips. Generally, you\par will locate the CIB and PC near the corner of your ceiling area where the first\par strip is located. If your system has more than 128 Beacon Array strips (covers}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 4\par }{\f5\fs24 more than 170 square feet) these will be divided up into 2 or more ‘banks’ of\par strips. The first strip of each bank is cabled to the CIB and will affect the\par placement of the CIB and PC.\par }{\b\f2 Figure 3 CIB\par }{\f5\fs24 To begin installation and testing of the HiBall system, connect a single strip to\par the CIB. The remainder of the strips will be installed later.\par }{\f6\fs28\cf4 2.2.2 Connections and Power Up\par }{\f5\fs24 The next step is to set up the HiBall PC }{\b\f2\fs24 ALONE}{\f5\fs24 .\par Note: Do NOT connect any other components to the PC. Do not\par connect the PC to your network.\par Connect the standard monitor, keyboard and mouse to the HiBall PC and power\par it on. The PC has been pre-configured for the HiBall Tracker System. }{\b\f2\fs24 Do not\par do any of the configuration steps described in the PC’s documentation}{\f5\fs24 .\par After the system boots you should see the standard Windows NT login prompt.\par Two user accounts have been set up: (change passwords as necessary)\par }{\f7\fs16 q  }{\f5\fs24 Login: }{\f8\fs24 tracker}{\f5\fs24 , Password: }{\f8\fs24 tracker }{\f5\fs24 – for running the HiBall\par tracker server or changing the tracker configuration.\par }{\f7\fs16 q  }{\f5\fs24 Login: }{\f8\fs24 Administrator}{\f5\fs24 , Password: }{\f8\fs24 Administrator }{\f5\fs24 – for\par changing the PC’s configuration.\par Note: Capitalization is important for login and password.\par Log on to the HiBall PC as ‘tracker’. You should see several shortcuts on the\par desktop including ‘HiBall Server’, ‘One Strip LED Test’, ‘HiBall\\bin prompt’,\par and ‘HiBall Files’. All HiBall Tracker files are typically installed under\par ‘E:\\hiball\\’. (If you don’t have the shortcuts you can run the programs directly\par from E:\\HiBall\\bin\\.) The file ‘HiBall Installation Information’ contains sitespecific\par installation details that you will need to refer to later. Double-click its\par desktop icon to read this information when needed.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 5\par }{\f6\fs28\cf4 2.2.3 Connecting the CIB, HiBall Sensor, and a beacon\par strip.\par }{\f5\fs24 Make the following connections with the CIB powered off.\par }{\b\f2\fs24 WARNING: Always power off the CIB before\par connecting or disconnecting any cables.\par }{\f5\fs24 A note about grounding:\par }{\b\f2\fs24 The HiBall uses extremely high-gain amplifiers and\par is therefore grounded to shield it from noise. This\par may make the electronics susceptible to static\par electricity in some high-static environments. Users\par need to be properly grounded before handling the\par HiBall or CIB.\par }{\b\f9\fs24\cf5 Connections:\par }{\f5\fs24 1. Connect the standard EPP 1284 cable from the CIB connector\par labeled ‘Host PC I/O (IEEE 1284C)’ to the PC’s add-in, PCI-card\par parallel port (}{\i\f4\fs24 not the standard parallel ‘printer’ port}{\f5\fs24 ). It has been\par labeled ‘To CIB’.\par 2. Connect the cable marked ‘buttons’ from the CIB connector labeled\par ‘Buttons out’ to the PC’s standard parallel port (marked with the\par printer icon).\par 3. Connect a HiBall sensor to the CIB using a HiBall tether cable.\par Connect only one HiBall sensor for this system test. The }{\i\f4\fs24 HiBall\par Installation Information }{\f5\fs24 document indicates a default assignment of\par sensors to tether ports. Connect the HiBall assigned to tether port 0.\par HiBall serial numbers are marked on the base of the HiBall.\par }{\b\f2\fs24 WARNING: HIBALL SENSORS ARE HIGHLY\par SENSITIVE, CALIBRATED INSTRUMENTS –\par HANDLE THEM CAREFULLY. DO NOT DROP.\par }{\f5\fs24 4. Connect a Beacon Array strip to the CIB at the ‘Bank 0’ connection\par using a CIB-to-strip cable. (Note: When the full system is installed,\par this cable will connect to a Power Distribution Box instead of\par connecting to the first Beacon strip. This is described later in the\par installation.) CIB-to-strip cables differ from strip-to-strip cables in\par length and in wiring. They are not interchangeable. The CIB-tostrip\par cables are 20 feet long (custom lengths are available). Both\par ends of the CIB-to-strip are the same. Connect either end to the\par ‘In’ end of a beacon strip, which is marked with a colored dot.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 6\par }{\b\f2\fs24 NOTE: Create a support for the cable near the\par connection to the beacon strip. Supporting the entire\par weight of the cable with the connector alone can\par damage the connector over time.\par }{\f5\fs24 5. Connect the other end of the CIB-to-strip cable to the CIB at ‘Bank\par 0’.\par }{\b\f2\fs24 Warning: the beacon strips are not symmetric.\par Connecting strips backwards may damage them.\par The ‘In’ end of a strip is marked with a dot of yellow\par or red paint near the connector.\par 6. }{\f5\fs24 Connect the power cable to the CIB and plug it in.\par }{\b\f2\fs24 7. }{\f5\fs24 Connect the video camera (supplied) to a TV monitor and point the\par camera at the strip.\par }{\b\f2\fs24 8. }{\f5\fs24 Power on the CIB.\par }{\f6\fs28\cf4 2.2.4 Initial System Test\par }{\f5\fs24 Run the ‘One Strip LED Test’ shortcut on the PC’s desktop. This runs the\par command ‘E:\\HiBall\\bin\\ledtest.exe E:\\HiBall\\config\\trackerOnestrip.cfg’. (To\par view or change a shortcut’s command line arguments, right-click on it, select\par Properties and then click the Shortcut tab.)\par This program will test communication between the HiBall PC, the CIB, the\par HiBall sensor, and the Beacon Array. It will open a DOS window and display\par several start-up status messages followed by a short menu. If you see error\par messages and no menu, quit the program (press CTRL-C or click on the }{\f10\fs24 T}{\f5\fs24 ),\par check that all cable connections are as described in the previous section, and try\par again. The menu should appear as follows:\par }{\f11\fs18 HiBall 3000 LED Test\par Select one: n - fire next LED in row-column order\par p - fire previous LED in row-column order\par r - fire LEDs randomly\par s – scan full ceiling in row-column order\par q – quit\par }{\f5\fs24 If you see error messages, refer to Section 5 of this manual, which contains\par troubleshooting information that may help you determine the problem.\par If there are no error messages and you see the menu, select ‘n’ to blink the first\par LED on the strip. It should print a message like\par 40 LED blinks in 0.078 s, 510 per second (0 bad)\par This program fires the same LED 40 times so that it’s easier for the user to see.\par If the message says there are bad reports, this may mean the HiBall is not\par connected properly.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 7\par }{\f5\fs24 Note: The system is taking HiBall readings during this test, but you\par do not need to point the HiBall at the LEDs.\par The LED blinks should be visible with the camera provided for installing your\par system, or with any camera that picks up Infrared (IR) signals. If the room is\par very bright, the camera may close its shutter and not pick up the LED flashes.\par Try turning off lights if this happens.\par If you continue pressing ‘n’, the program will light up all the LEDs in\par sequence. The program has other options for other LED orders – ‘r’ for\par random, ‘s’ for all LEDS in sequence. Verify that all 8 LEDs on the strip blink\par one at a time, and in order using the ‘n’ command, before you continue to the\par next step.\par }{\f6\fs32\cf3 2.3 Step 2 – Configure Beacon Strips\par }{\f5\fs24 Once you have run a successful initial system test you are ready to install and\par connect the remaining Beacon Array strips. We recommend reading through\par this entire section before beginning the ceiling installation.\par }{\b\f2\fs24 Remember to power off the CIB before connecting\par or disconnecting any components!\par }{\f5\fs24 The system components you received should include the number of strips,\par PDBs, and cables required to build the ceiling configuration you specified. The\par software is also pre-set for this configuration. Check the }{\i\f4\fs24 HiBall Installation\par Information }{\f5\fs24 document for details on your configuration. If you need to change\par the ceiling layout, refer to Section 6.1 or contact 3rdTech. }{\b\f2\fs24 We recommend\par that you connect and test the pre-configured Beacon Array first before you\par make any customizations.\par }{\f5\fs24 Note: If you change the ceiling configuration you must also change\par the software configuration files. Refer to Section 6.1.\par As an example, a standard Model C18 configuration (12 ft. x 12 ft., 108 Beacon\par Arrays) is shown in Figure 4 (layout diagram). Refer to the diagram included\par with your }{\i\f4\fs24 HiBall Installation Information }{\f5\fs24 document for the layout that\par corresponds to your configuration.\par }{\f6\fs28\cf4 2.3.1 Beacon Strip Installation\par }{\f5\fs24 The document }{\i\f4\fs24 HiBall Installation Information }{\f5\fs24 contains a list of the number of\par beacon strips, the number of cables and their lengths, and the number of PDBs\par in your configuration. A beacon strip is a single 2ft. x 1in. x 0.9in. strip with 8\par infrared LEDs. (A Beacon Array Module (BAM) is a set of six Beacon Strips.\par For installation, we consider individual strips rather than BAMs.) A strip can\par be installed in a drop ceiling by sliding the ends between the tile and the\par support lattice, as shown in Figure 2, or by mounting on a solid surface using}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 8\par }{\f5\fs24 the two mounting holes. Cables come in several different lengths depending on\par where they are used in the ceiling layout. There are both strip-to-strip cables\par and power distribution cables. Refer to your installation diagram to see which\par cables correspond to which connections.\par }{\b\f2 Figure 4 Ceiling Grid Layout – standard C18 (12ft. x 12ft.) as seen from above. The first\par LED on the first beacon strip is circled and marked with ‘B0’. The X-axis extends from\par BO to the right. The Y-axis extends from BO to the top. A power distribution box is\par shown next to the first Beacon strip and others between rows 8 and 9, and rows 16 and 17.\par }{\b\f9\fs24\cf5 Install the Beacon Strips\par }{\f5\fs24 The beacon strips are typically connected end-to-end across the width of the\par ceiling and back again in a ‘daisy chain’ (other configurations are possible).\par Figure 4 illustrates the typical connection scheme. LED rows must be 8 inches\par apart (20.3 cm), i.e., three per 2ft. x 2ft. tile, 6 per 2ft. x 4ft. tile. Use the\par installation ruler provided to ensure you keep to the 8” spacing between rows\par (the ruler measures 7”, which corresponds to the space from the inside edge of\par one strip to the inside edge of the next.) There is tolerance in the system for\par approximately ½ inch (1.3 cm) error in where you place the strips. The ceiling}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 9\par }{\f5\fs24 layout in the diagram illustrates a grid on 2 ft. by 2 ft. ceiling tiles (0.61 m by\par 0.61 m).\par Note: If your ceiling tiles are 2ft. x 4ft. the strips will be installed\par across the short dimension of the ceiling panel – 6 strips per panel.\par Install the strips in your ceiling according to your custom diagram. The first\par strip in the ceiling is marked in the figure with ‘B0’ and with a circle around\par the first LED. This strip should be located near the CIB.\par Strips are labeled in map diagrams as ‘bank#/strip#’ to aid in correctly\par connecting the strips. The ‘In’ end of a strip is marked in the diagram with a\par large black dot. It is very important to orient strips correctly – an ‘Out’ end\par must connect to an ‘In’ end. ‘In’ is marked with a colored dot (yellow or red)\par on the strip near the connector.\par }{\b\f2\fs24 Warning: The Beacon strips are not symmetric. The\par ‘In’ end on a strip is marked with a yellow or red dot.\par Connecting strips backwards may damage them.\par }{\b\f9\fs24\cf5 Install the Power Distribution Boxes\par }{\f5\fs24 Power Distribution Boxes (PDBs) distribute power over sections of a Beacon\par strip bank. Typical configurations will require a PDB for }{\i\f4\fs24 approximately }{\f5\fs24 every\par 36 Beacon strips. (Note: This will vary with the size, configuration and cabling\par of your configuration.) Your map diagram shows the location of your PDBs.\par The PDB has a magnet and can simply attach to the support lattice of your drop\par ceiling as shown in Figure 1. If necessary, the cover of the PDB can be\par removed and the base of the PDB can be attached to the ceiling with screws, or\par it can be attached with the double-sided tape provided.\par }{\b\f2 Figure 5 Power Distribution Box\par }{\b\f9\fs24\cf5 Connect Cables\par }{\f5\fs24 A CIB-to-strip cable connects the CIB to the first PDB for each bank of Beacon\par strips as shown in Figure 6. There are 4 numbered connectors on the PDB –\par two 8-conductor RJ45 (1 and 3) and two 6-conductor RJ25 (2 and 4). Connect}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 10\par }{\f5\fs24 the CIB-to-strip cable to connection 1 or 3. The other end of the cable connects\par to CIB bank 0.\par Note: It doesn’t matter which is selected – Figure 6 shows it\par connected to 1. However, if you select 1, then 1 and 2 are both\par ‘input’ connections and 3 and 4 are both ‘output’ connections. If\par you select 3, than the reverse is true. You may not mix inputs and\par outputs, e.g. you cannot make 1 an input and 2 an output.\par }{\b\f2\fs24 Note: Remember to create a support for the weight\par of the CIB-to-strip cable.\par }{\b\f2 Figure 6 Power Distribution Box Connected to CIB and Strip 0\par }{\f5\fs24 Now connect the }{\i\f4\fs24 BO }{\f5\fs24 strip to the other RJ45 connection (1 or 3; 3 in Figure 6)\par with a small strip-to-strip cable. If you have multiple banks, as marked in your\par layout diagram, then connect a PDB to the corresponding bank port on the CIB,\par and to the first strip in each bank, in the same manner.\par If you have more than approximately 36 Beacon strips in a bank you will have\par additional PDBs. These connect ‘in line’ as shown in Figure 5. Connect the ‘out\par cable’ from one strip to connection 1 or 3 and the ‘in cable’ from the next strip\par to the other RJ45 connector. In addition, a 6-conductor Power Distribution\par cable connects the first PDB (RJ25 connector 2 or 4; 4 in Figure 6) to the\par ‘input’ connector 2 or 4 of the next PDB in the same bank (as shown in Figure\par 5).\par Note: In Figure 5, if 1 is selected as an input, then 2 must be the\par other input and 3 and 4 are outputs. If 3 is selected as an input, the\par 4 must be the other input and 1 and 2 are outputs.\par }{\f6\fs28\cf4 2.3.2 Full Ceiling Test\par }{\f5\fs24 Once all the ceiling strips are installed, as well as a single HiBall Sensor (you\par must have a HiBall Sensor connected to do the next test), turn on the CIB}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 11\par }{\f5\fs24 power. Now run the ‘Full Ceiling LED test’ shortcut (this runs the program\par }{\i\f4\fs24 ledtest}{\f5\fs24 , as in Section 2.2 with your main tracker configuration file – see your\par Installation document for the name of that file). This test will verify that the\par strips are connected and functioning properly. You should use the video\par camera and TV to view the LEDs as they fire as you did in the earlier test.\par The program should display the same options as described in Section 2.2. Use\par the ‘n’ command to step through all LEDs in the ceiling to verify that they\par work. This will light LEDs in ‘row-column’ order. The first LED that fires\par will be LED 0 on strip 0 – the first strip connected to the CIB (this LED is\par circled in the ceiling map diagram). The next LED is the next one along that\par strip. The next LED is the next on that strip, and so on in that row all the way\par across the ceiling. Then it will start back on the next row, and so on.\par }{\b\f2\fs24 Verify that all LEDs in the ceiling light in exactly the correct\par order (using the ‘n’ and ‘p’ commands). }{\f5\fs24 Once you’ve verified\par this you can do subsequent tests, when necessary, using the faster\par ‘r’ (random) or ‘s’ (scan all) tests, which quickly determine what\par LEDs are firing (though they will not verify the ordering).\par Possible problems you may see are:\par }{\f7\fs16 q  }{\f5\fs24 LEDs not firing beyond a certain point in the ceiling\par }{\f7\fs16 q  }{\f5\fs24 Certain LEDs staying on all the time while other LEDs are firing.\par If any problems occur, power down the CIB and check connections. Make sure\par that strips are not reversed.\par }{\b\f2\fs24 Remember to turn off the CIB before connecting or\par disconnecting any components.\par }{\f5\fs24 If problems continue, try testing the ceiling in increments – add one row at a\par time, or connect different subsets of strips (making sure that strips are not\par reversed) – to identify the location of the problem.\par Note: For these tests you can have fewer strips connected than are\par in your ceiling map. Also, you need to have one HiBall connected\par for these tests – though you do not need to point it at the LEDs.\par Try to isolate the strip or cable where the problem begins, and remove it. In\par these incremental tests, use the ‘r’ and ‘s’ commands. Also check that the\par tracker configuration file that you are specifying when you run ‘ledtest’\par corresponds to the tracker configuration file named in your installation\par document. If the problems remain unresolved, or if you determine that any of\par the strips or cables are defective, contact 3rdTech.\par If all LEDs on the ceiling fire correctly in this test, the system is ready to begin\par tracking as described in Section 3. If you have additional HiBall sensors you\par will connect them in the next section, otherwise skip to section 3.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 12\par }{\f6\fs32\cf3 2.4 Connecting additional HiBall sensors\par }{\f5\fs24 To connect a second HiBall sensor, }{\b\f2\fs24 turn off the CIB }{\f5\fs24 and connect the sensor to\par the CIB tether port according to your installation document. The standard\par ‘two-HiBall configuration’ in that document specifies which HiBall sensor\par should connect to which tether port.\par Note: Each HiBall sensor has its own configuration and calibration\par files (each sensor is calibrated individually to correct for slight\par differences in manufacturing). You must make sure that the HiBall\par physically connected to a given tether port matches the assignment\par in the }{\i\f4\fs24 Tracker Configuration File. }{\f5\fs24 See Section 6.2 for a description\par of the configuration files.\par }{\f6\fs32\cf3 2.5 Mounting HiBall sensors\par }{\f5\fs24 To mount a HiBall sensor on a head-mounted display, on the HiBall-3000\par Stylus, or other objects, use the two mounting holes on the base of the HiBall.\par These take standard 6-32 screws. The two holes are 1.04 inch (26.46 mm)\par apart along the X axis. The 6-32 holes are ¼” deep. DO NOT ATTEMPT TO\par FORCE SCREWS ANY DEEPER THAN THIS – YOU COULD DAMAGE\par THE HIBALL SENSOR. There is also a single hole in the center, size ¼-20\par (standard camera mount thread).\par }{\f6\fs44\cf2 3 Operation\par }{\f6\fs32\cf3 3.1 Running the HiBall Server\par }{\f5\fs24 Once the system components have been connected and the Beacon Arrays have\par been tested, you are ready to power on the CIB and run the HiBall Server. This\par program starts the system tracking, generates measurements, and relays them\par (as VRPN reports) to client applications.\par You can run the server directly from the desktop shortcuts that have been set up\par on the HiBall server PC. There should be a standard shortcut called }{\i\f4\fs24 HiBall\par Server }{\f5\fs24 that runs the default number of sensors (one or two, as described in your\par }{\i\f4\fs24 HiBall Installation Information }{\f5\fs24 document) as well as additional shortcuts for\par other combinations of sensors}{\i\f4\fs24 .\par }{\f5\fs24 Alternatively, you can run the HiBall server directly from a DOS prompt,\par specifying the appropriate VRPN server configuration file. There’s a shortcut\par on the desktop to get a DOS prompt in the E:\\HiBall\\bin folder. Run\par vrpn_server –f E:\\HiBall\\config\\vrpnC18.cfg}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 13\par }{\f5\fs24 (replace vrpnC18.cfg with the configuration file specified in your installation\par document).\par }{\b\f2\fs24 Do not run any other applications on the HiBall\par Server PC. Running other applications on the PC\par will seriously degrade HiBall Tracker performance.\par }{\f6\fs28\cf4 3.1.1 HiBall Server Control Panel\par }{\f5\fs24 When you run the HiBall Server program it will output status messages to a\par DOS window and it will bring up a graphical control panel, shown in Figure 7.\par (If the control panel does not appear, check the DOS window for error\par messages, and double-check physical connections. If the DOS window\par disappears, try opening a new DOS window and running the server from the\par prompt, as described above. To check which configuration file argument the\par shortcut uses, right-click on it and select ‘shortcut’.)\par }{\b\f2 Figure 7 HiBall Server control panel.\par }{\f5\fs24 The top part of the control panel shows the following:}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 14\par }{\f7\fs16 q  }{\i\f4\fs24 HiBall update rates }{\f5\fs24 for HiBall 0 and HiBall 1. HiBall 0 is the first\par HiBall referenced in the Tracker Configuration File (typically the one\par on tether port 0). HiBall 1 is the second HiBall referenced in this file.\par At startup, and when a HiBall is outside the range of the ceiling, this\par will show a red ‘ACQ’, indicating that the tracker is acquiring (see\par below for details).\par Note: A typical measurement rate for a single HiBall sensor is\par 1000 to 2000 Hz. For two sensors, the measurement rate for each\par decreases by approximately half. Measurement rate also varies\par somewhat with the sensor’s location in the environment. The rate\par may decrease when the tracker is near the edge of the tracking\par region or near the floor. Small changes in measurement rate\par (within a few hundred Hz) have no noticeable effect on tracking\par performance.\par }{\f7\fs16 q  }{\i\f4\fs24 Uptime }{\f5\fs24 shows how long the HiBall server has been running.\par }{\f7\fs16 q  }{\i\f4\fs24 More }{\f5\fs24 button hides or displays the lower part of the panel.\par At the bottom of the control panel there are three buttons:\par }{\f7\fs16 q  }{\i\f4\fs24 Apply changes }{\f5\fs24 – to accept changes to edited text fields.\par }{\f7\fs16 q  }{\i\f4\fs24 Dismiss }{\f5\fs24 – to hide the entire control panel. The HiBall server will\par continue to run without the control panel.\par }{\f7\fs16 q  }{\i\f4\fs24 Shutdown }{\f5\fs24 – to stop the tracker.\par The central part of the control panel has four tabs. The }{\i\f4\fs24 Configuration }{\f5\fs24 tab lists\par the configuration files the tracker is using, and indicates which HiBall is\par connected to which tether port. Refer to your }{\i\f4\fs24 HiBall Installation Information\par }{\f5\fs24 document for more details about the files installed on your system. In addition,\par it has the following controls for diagnostic use.\par }{\f7\fs16 q  }{\i\f4\fs24 View log }{\f5\fs24 – view status information, saved to a file in E:\\HiBall\\logs\\.\par The server keeps in that folder the 10 most recent log files.\par }{\f7\fs16 q  }{\i\f4\fs24 Suspend tracker }{\f5\fs24 – temporarily stop the tracker.\par }{\f7\fs16 q  }{\i\f4\fs24 Force re-acquire }{\f5\fs24 – force the tracker to lose tracking and re-acquire.\par The }{\i\f4\fs24 VRPN Server }{\f5\fs24 tab contains the following information about VRPN and\par client-server communication properties (see Figure 8).\par }{\f7\fs16 q  }{\i\f4\fs24 Connections }{\f5\fs24 – shows whether a client application is connected from\par another machine, and the length of time it has been connected.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 15\par }{\f7\fs16 q  }{\i\f4\fs24 Report rate (Hz) }{\f5\fs24 – shows the rate at which the server is relaying VRPN\par tracker reports to clients. This number can be set in the VRPN\par configuration file (see Section 6.2).\par }{\f7\fs16 q  }{\i\f4\fs24 VRPN version }{\f5\fs24 – shows the VRPN version that was compiled with the\par HiBall Server. The major version number (which is 5 in the figure)\par must match the major version number of the copy of VRPN that you\par use with your client code. See Section 6.4 for information about\par software upgrades.\par }{\b\f2 Figure 8 HiBall Server control panel, showing VRPN server details.\par }{\f5\fs24 The }{\i\f4\fs24 Beacons }{\f5\fs24 tab indicates whether Beacon Autocalibration is on or off, and\par allows you to save calibrated ceiling maps. See Section 6.3 for more\par information on customizing autocalibration.\par The }{\i\f4\fs24 Post-Filtering }{\f5\fs24 tab (see Figure 9) allows you to apply different types of\par smoothing filters to the tracker measurements in order to minimize jitter. You\par should use post-filtering only if jitter is noticeable in your application. Only\par one type of filter may be applied at a time.\par }{\f7\fs16 q  }{\i\f4\fs24 No filtering or prediction – }{\f5\fs24 if this box is checked, no post-filtering or\par prediction is applied.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 16\par }{\f7\fs16 q  }{\i\f4\fs24 Median filter – }{\f5\fs24 applies a median filter to tracker measurements. The\par value that is sent through VRPN is the median of the last N\par measurements. This field accepts values of N between 3 and 23.\par }{\f7\fs16 q  }{\i\f4\fs24 Averaging post-filter time (ms) }{\f5\fs24 – this applies a moving window\par averaging filter over the specified number of milliseconds to smooth\par the data. We recommend approximately 100 ms or less. Larger values\par will add noticeable latency.\par }{\f7\fs16 q  }{\i\f4\fs24 Exponential averaging }{\f5\fs24 – this applies an exponentially weighted\par moving window averaging filter. This is similar to the averaging postfilter\par but it places more weight on recent records and adds much less\par latency. Values can be between 0 and 100. Values between 80 and 97\par effectively reduce large amounts of jitter without adding noticeable\par latency.\par }{\f7\fs16 q  }{\i\f4\fs24 Prediction time (ms) }{\f5\fs24 – requests that the tracker predict ahead in time by\par the specified number of milliseconds. The latency for the HiBall\par tracker is typically less than 3 ms and prediction is often unnecessary.\par However, you can set this value to help counteract effects of latency in\par communication or client code. Values greater than approximately 20\par ms will cause apparent jitter because the tracker cannot predict reliably\par that far ahead. Note: You cannot enable both prediction and filtering at\par the same time.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 17\par }{\b\f2 Figure 9. Post-filtering tab in the HiBall Control Panel.\par }{\f5\fs24 The }{\i\f4\fs24 Multimodel }{\f5\fs24 tab contains information about the multimodel Kalman Filter\par switching. We recommend keeping multimodel switching enabled at all times\par (except while generating a new, autocalibrated ceiling map). This is the default\par in configurations shipped with HiBall Software Release 1.3 or later. See\par Section 6.4 for more information.\par }{\f6\fs28\cf4 3.1.2 HiBall Tracker operation\par }{\b\f9\fs24\cf5 Acquisition and tracking\par }{\f5\fs24 On startup the system will attempt to begin (or ‘acquire’) tracking for each\par HiBall sensor that is connected. If a sensor has not yet acquired tracking a red\par }{\i\f4\fs24 ACQ }{\f5\fs24 will appear in place of the measurement rate. Acquisition normally takes\par 1 or 2 seconds.\par The system executes Acquisition to find an estimate of the sensor’s\par location given no initial information.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 18\par }{\f5\fs24 Once acquisition succeeds, the tracker proceeds by rapidly updating its\par estimates after each LED blink using the SCAAT (Single-Constraint-AT-ATime)\par Kalman Filter. Tracking updates at rates up to 2000 Hz.\par Acquisition occurs once on startup and whenever the HiBall sensor is moved\par beyond tracking range – outside the area of the ceiling, tilted past 90 degrees,\par farther than 10 ft. from the ceiling, or obscured from any line-of-sight readings.\par Acquisition proceeds independently for each HiBall sensor. Other sensors will\par continue tracking while one is re-acquiring.\par }{\b\f9\fs24\cf5 Performance considerations\par }{\f5\fs24 For optimum performance, keep in mind the following factors.\par }{\f7\fs16 q  }{\f5\fs24 The sensor should be no closer than 1.5 ft. (.46 m) to the Beacon\par Arrays, and no further than 10 ft. (3.05 m) from the Beacon Array for\par accurate tracking. Outside this height range, the tracker may not\par acquire or may be less accurate.\par }{\f7\fs16 q  }{\f5\fs24 The orientation range for the sensor is a full +- 180 degrees in azimuth\par (about the Z axis) and 0 to 90 degrees in elevation (about X or Y). If\par you tilt the sensor downwards below 90 degrees, it won’t see enough\par LEDs to continue tracking. The elevation range is reduced near the\par edge of the Beacon Array.\par }{\f7\fs16 q  }{\f5\fs24 If you occlude a HiBall sensor completely (by leaning over it, for\par example), it may not see enough LEDs to continue tracking, or it may\par track only at a slow rate. Partial occlusion is generally not a problem.\par }{\f7\fs16 q  }{\f5\fs24 Avoid placing highly reflective objects near the HiBall sensor or the\par beacon strips. Strong reflections may reduce tracking accuracy.\par }{\f7\fs16 q  }{\f5\fs24 Acquisition will happen fastest if you hold the HiBall sensor still and\par upright while it is acquiring (while the red ‘ACQ’ is showing on the\par screen).\par }{\f7\fs16 q  }{\f5\fs24 DO NOT RUN ANY OTHER APPLICATIONS ON THE HIBALL\par SERVER PC. IF YOU RUN OTHER APPLICATIONS ON THE PC\par TRACKER PERFORMANCE WILL DEGRADE SIGNIFICANTLY.\par }{\f7\fs16 q  }{\f5\fs24 The HiBall uses extremely high gain amplifiers and is therefore\par grounded to shield it from noise. This makes the electronics\par susceptible to static electricity in some high-static environments. Users\par should be properly grounded before handling the HiBall or CIB.\par }{\f7\fs16 q  }{\f5\fs24 If you get a shock when touching the system, it may stop tracking and\par require you to power down the CIB and restart. In some cases the\par software will detect and report ‘hardware error’ and automatically\par suspend tracking. In this case, uncheck the }{\i\f4\fs24 suspend tracking }{\f5\fs24 checkbox}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 19\par }{\f5\fs24 on the control panel. If tracking does not resume, power down the CIB\par and restart.\par }{\f7\fs16 q  }{\f5\fs24 Some types of lights affect HiBall tracker performance. If you see\par excessive jitter, try turning off lights in the environment, especially any\par lights directly behind the beacon strips.\par }{\f6\fs32\cf3 3.2 Running client applications\par }{\f5\fs24 Once you have the HiBall server running and generating measurements, you\par can start a client application to receive those measurements. You can stop and\par restart client applications at any time while the HiBall server is running.\par Connections to the HiBall server will be established (or re-established)\par automatically by VRPN. The next section describes how to create your own\par client applications using VRPN. Section 4.1.6 describes sample client\par applications included with the HiBall-3000 system.\par }{\f6\fs44\cf2 4 Application Interface (VRPN)\par }{\f5\fs24 The principal interface to the HiBall-3000 tracker is through the Virtual Reality\par Peripheral Network (VRPN) library. VRPN provides client-server\par communication, among a variety of VR components, over Ethernet\par connections.\par VRPN is the recommended interface to the HiBall Tracker for several reasons:\par }{\f7\fs16 q  }{\f5\fs24 It provides a common interface to different trackers as well as\par interfaces to many other devices.\par }{\f7\fs16 q  }{\f5\fs24 It provides automatic timestamps, clock synchronization, record-to-file\par and replay-from-file\par }{\f7\fs16 q  }{\f5\fs24 It provides support for multiple clients connecting to a single device.\par VRPN provides optimum performance and flexibility when interfacing to the\par HiBall-3000 tracker. VRPN was developed at the University of North Carolina\par at Chapel Hill and is supported by 3rdTech. Additional information about\par VRPN can be found at\par }{\i\f4\fs22 http://www.cs.unc.edu/Research/vrpn/\par }{\f6\fs32\cf3 4.1 VRPN\par }{\f5\fs24 This section will guide you through installing VRPN and integrating it with\par your application. (We do not fully replicate the VRPN documentation, which is\par available both at the site listed above and on the HiBall Tracker CD.)}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 20\par }{\f6\fs28\cf4 4.1.1 Install VRPN Client Software\par }{\f5\fs24 To begin, you will install VRPN onto your }{\b\f2\fs24 client }{\f5\fs24 computer on which you will\par run your HiBall applications.\par Do not install it on the HiBall PC, which must ONLY run the\par HiBall server.\par If you already have the current version of VRPN installed (as of the time of this\par manual printing, version 6.02) you do not need to re-install it. You can obtain\par updated versions of VRPN at the web site listed above.\par The HiBall Software CD includes:\par }{\f7\fs16 q  }{\f5\fs24 VRPN (Virtual Reality Peripheral Network) files and documentation.\par VRPN has been tested on the following architectures: SGI/Irix,\par PC/Win32, PC/Cygwin, HP700/HPux, Sparc/Solaris, PC/Linux.\par }{\f7\fs16 q  }{\f5\fs24 Sample HiBall tracker application code for VRPN under Windows NT\par }{\f7\fs16 q  }{\f5\fs24 A backup copy of the HiBall Server software, which is already\par installed on the HiBall PC.\par }{\b\f9\fs24\cf5 To install VRPN\par }{\f12 1. }{\f5\fs24 Copy the VRPN folder from the HiBall Software CD to the computer\par running your application, and build the VRPN library and the test\par applications. Refer to the main page of the VRPN documentation for\par details on compiling and follow the instructions there.\par }{\f12 2. }{\f5\fs24 Connect the HiBall Tracker PC Server to your local network and set its\par network properties appropriately. If you change the machine name\par (default is ‘HiBall’) then you will need to change HiBall configuration\par files – refer to Section 6.2. Set the time zone on the HiBall Tracker PC\par Server appropriately for your location. A mismatch in time zones\par between computers on your network may cause VRPN errors.\par The VRPN documentation (on the web site and on the CD) includes details on\par how to write VRPN applications for any tracker. The following section briefly\par describes how to use the HiBall Tracker with VRPN.\par }{\f6\fs28\cf4 4.1.2 Writing a VRPN/HiBall client application\par }{\f5\fs24 VRPN devices are referred to by a device name and a machine name, as in\par }{\i\f4\fs24 device@machine}{\f5\fs24 . HiBall tracker devices will be named }{\i\f4\fs24 Tracker0@hiball}{\f5\fs24 ,\par where }{\i\f4\fs24 hiball }{\f5\fs24 is the name given to the HiBall PC. You can use an IP address in\par place of machine name, and in some cases VRPN will establish connections\par faster if you give an IP address. (Make sure you capitalize the T in ‘Tracker0’\par – case is significant for VRPN device names.)}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 21\par }{\f5\fs24 Your applications should include the code listed in Figure 10. For more details\par see the section of the VRPN manual on client software and on\par }{\i\f4\fs24 vrpn_Tracker_Remote}{\f5\fs24 . Also see the sample tracker client file in the VRPN\par source tree.\par }{\b\f2 Figure 10 C/C++ Code to include in HiBall/VRPN Applications\par }{\f5\fs24 The HiBall tracker operates as a standard }{\i\f4\fs24 vrpn_Tracker_Remote }{\f5\fs24 class. You\par communicate with it as you would with any other VRPN-supported tracker.\par The application creates a new vrpn_Tracker_Remote class and registers a\par callback function to process records from the device. In the main loop of your\par code you call the tracker’s }{\i\f4\fs24 mainloop( ) }{\f5\fs24 function to generate a record.\par A sample callback function is illustrated in Figure 11. The callback function\par gets called every time a new record has been received from the HiBall server\par for any sensor.\par }{\b\f2 Figure 11 Sample VRPN Callback Function\par }{\f5\fs24 The client will receive records from the HiBall server at the rate specified in the\par VRPN configuration file. This rate is displayed on the ‘VRPN Server’ tab on\par the server control panel. You can change this rate by changing the VRPN\par configuration file (see Section 6.2). The default is typically 72 Hz. This rate\par should be no less than your program’s display or computation loop.\par }{\f11\fs18 #include <vrpn_Tracker.h>\par // create a tracker object\par vrpn_Tracker_Remote Tracker("Tracker0@hiball");\par // Register a callback to process records\par Tracker.register_change_handler(NULL,\par handle_tracker);\par // program’s main loop\par while (!done)\par \{\par // This calls the tracker driver, which will call\par // your handler function as necessary\par Tracker.mainloop();\par \}\par void handle_tracker(void *userdata, const\par vrpn_TRACKERCB t)\par \{\par printf("handle_tracker: Sensor %d is now at\par (%g,%g,%g)\\n", t.sensor,\par t.pos[0], t.pos[1], t.pos[2]);\par \}}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 22\par }{\f5\fs24 If your program’s main loop runs significantly faster than the VRPN update\par rate for the device (and you do not wish to change the server update rate), you\par may wish to ensure that your callback always gets a new record each time your\par program goes through its main loop. See the vrpn_Tracker_Remote\par documentation for code to do this.\par }{\b\f9\fs24\cf5 Record Format\par }{\f5\fs24 The callback function you create receives a tracker record with the format\par specified in Figure 12.\par }{\b\f2 Figure 12 VRPN Tracker Record Format\par }{\f7\fs16 q  }{\f5\fs24 The }{\b\f2\fs24 pos }{\f5\fs24 and }{\b\f2\fs24 quat }{\f5\fs24 fields give the position and orientation of the HiBall\par sensor with respect to tracker coordinates.\par }{\f7\fs16 q  }{\f5\fs24 The position (translation) is returned as floating-point values in meters\par (X, Y, Z).\par }{\f7\fs16 q  }{\f5\fs24 The orientation quaternion (rotation) is returned as floating-point (X,\par Y, Z, W). VRPN’s quaternion convention is (X, Y, Z, W), where W is\par the scalar component, and X, Y, Z specify the axis of rotation. The\par whole quaternion vector is normalized. VRPN provides functions to\par convert from quaternions to Euler angles (additional information is in\par Section 4.1.4).\par }{\f6\fs28\cf4 4.1.3 Coordinate Systems\par }{\f5\fs24 The ‘pos’ and ‘quat’ fields returned in the VRPN Tracker record form the\par ‘sensor coordinates to tracker coordinates’ transformation, with the translation\par first, followed by the rotation. That is, this transformation will take points in the\par sensor coordinate frame to the tracker coordinate frame.\par }{\f11\fs18 typedef struct \{\par struct timeval msg_time; // Time of the report\par long sensor; // Which sensor is\par // reporting\par float pos[3]; // Position of the\par // sensor\par float quat[4]; // Orientation of the\par // sensor\par \} vrpn_TRACKERCB;}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 23\par }{\f5\fs24 The sensor coordinate frame is defined with +Z up, +X along the HiBall tether,\par and +Y ninety degrees counter-clockwise from +X when viewed from above\par (X, Y, Z form a right-handed coordinate system). The origin is at the center of\par the base of the HiBall sensor. Figure 13 illustrates the coordinate system.\par }{\b\f13\fs23 Sensor coordinates Tracker coordinates\par Z\par Y\par X\par }{\f14\fs23 Floor\par Ceiling\par }{\b\f13\fs23 X\par Y\par Z\par CIB\par }{\b\f2 Figure 13 Coordinate Systems for the HiBall Tracker.\par }{\f5\fs24 The tracker coordinate frame has +Z up, and X and Y along the edges of the\par Beacon Array configuration to form a right-handed coordinate system (X and Y\par are marked on your ceiling map diagram for reference.) The origin of the\par tracker coordinate frame is on the floor directly beneath the first LED on the\par first strip in Bank 0. This point is marked with a circle in your ceiling map\par diagram. Note that the height of your ceiling, as specified in the ceiling map\par editor and indicated in the ceiling map diagram, determines the Z-point of the\par origin. If you specify a height of zero, the origin will be at the height of the\par LEDs.\par In your application, typically, you will want to introduce additional coordinate\par systems for convenience. We recommend maintaining a coordinate-system tree\par as in Figure 14, at least conceptually.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 24\par }{\b\f13\fs19 Tracker\par World\par Objects\par Sensor 0\par Unit 0\par Sensor 1\par Unit 1\par }{\b\f2 Figure 14 Coordinate Systems for Tracking.\par }{\f5\fs24 Each dot in the tree is a coordinate system frame. The lines between them\par represent transformations between two coordinate systems (and these can be\par composed, inverted, etc.).\par The HiBall Tracker returns sensor-to-tracker (or ‘tracker-from-sensor’)\par transformations. The other transformations are typically needed for VR\par applications. VRPN has an optional facility to maintain tracker-to-world and\par unit-to-sensor transformations automatically. You can define these in a file\par called }{\i\f4\fs24 vrpn_Tracker.cfg. }{\f5\fs24 This is described in the }{\i\f4\fs24 vrpn_Tracker_Remote }{\f5\fs24 section\par of the VRPN manual.\par Alternatively, you can maintain these extra coordinate systems in your code. A\par tracker-to-room transformation is useful if you want to redefine the origin for\par your tracked space. A unit-to-sensor transformation (e.g., head-to-sensor or\par hand-to-sensor) enables you to easily go from HiBall sensor coordinates to a\par meaningful coordinate frame on a head-mounted display or hand-held device.\par Section 4.1.5 describes the offsets for the HiBall-3000 stylus.\par Using a scheme like this simplifies drawing objects attached to different\par frames. To attach an object to the sensor’s position, for example, you enforce a\par constraint about the sensor-to-object (or unit-to-object) transformation.\par For more information about using coordinate systems for tracking and virtual\par reality, we recommend the following references:\par }{\f5\fs22 Foley, J.D., A. van Dam, Steven K. Feiner, and John F. Hughes (1990). }{\i\f4\fs22 Computer\par Graphics: Principles and Practice, 2}{\i\f4\fs14 nd }{\i\f4\fs22 edition. }{\f5\fs22 Addison-Wesley Publishing Company.\par Robinett, Warren and Richard Holloway (1992). “Implementation of flying, scaling,\par and grabbing in virtual worlds}{\i\f4\fs22 .}{\f5\fs22 ” In }{\i\f4\fs22 Proceedings of the 1992 ACM Symposium on\par Interactive 3D Graphics}{\f5\fs22 , 189-192.\par Robinett, Warren and Richard Holloway (1995). “The Visual Display Transformation\par for Virtual Reality.” }{\i\f4\fs22 Presence, }{\f5\fs22 4(1), 1-23.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 25\par }{\f6\fs28\cf4 4.1.4 Quaternions\par }{\f5\fs24 The HiBall server and VRPN use the quaternion format for rotations. A note\par about quaternions (excerpt from the VRPN manual):\par The quaternion angle representation stores the orientation as a fourvector,\par where the first three values specify the axis around which\par the rotation occurs and the fourth specifies the amount of rotation.\par The whole vector is normalized. This matches UNC’s }{\i\f4\fs24 quatlib\par }{\f5\fs24 format. Quatlib source code is included in recent VRPN releases; it\par shows up in a }{\i\f4\fs24 quat }{\f5\fs24 directory, alongside the }{\i\f4\fs24 vrpn }{\f5\fs24 and }{\i\f4\fs24 vrpn_html\par }{\f5\fs24 directories.\par For those not familiar with quaternions, they are a concise and\par efficient way of describing rotations and orientations of threedimensional\par objects. (Two good references for this subject are\par Ken Shoemake’s 1985 SIGGRAPH papers “Quaternion Calculus\par for Animation” and “Animating Rotation with Quaternion Curves”\par in the ’85 proceedings.)\par The library is built on Ken Shoemake’s code (as presented in the\par appendix of the first paper listed above) and implements the most\par common quaternion functions, as well as some more obscure ones.\par In particular, there are conversion routines between vectors,\par matrices and quaternions, as well as various vector and matrix\par operations.\par To convert between quaternions and Euler angles, you can use functions\par provided with the VRPN auxiliary library quatlib. The follow sample code will\par do this conversion.\par }{\b\f2\fs24 Euler angles to quaternion:\par }{\f11\fs18 #include <quat.h>\par q_type q;\par double yaw; // about Z\par double pitch; // about Y\par double roll; // about X\par // }{\i\f15\fs18 set values of yaw, pitch, roll\par }{\f11\fs18 // }{\i\f15\fs18 convert\par }{\f11\fs18 q_from_euler(q, yaw, pitch, roll);\par }{\b\f2\fs24 Quaternion to Euler angles:\par }{\f11\fs18 #include <quat.h>\par q_type q;\par q_matrix_type matrix;\par q_vec_type yawPitchRoll;\par // }{\i\f15\fs18 set value of quaternion q}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 26\par }{\f11\fs18 // convert\par q_to_col_matrix(q, matrix);\par q_col_matrix_to_euler(yawPitchRoll, matrix);\par }{\f6\fs28\cf4 4.1.5 Using the Stylus\par }{\b\f9\fs24\cf5 Offsets to stylus tip\par }{\f5\fs24 The HiBall-3000 stylus (Figure 15) consists of a handle with a ‘trigger’ button\par and an interchangeable metal probe. The probe (3/8”-24 thread) mounts at a\par 45-degree angle down from horizontal.\par The position offset from HiBall sensor coordinates to the }{\b\f2\fs24 base }{\f5\fs24 of the screw-in\par probe is\par [X, Y, Z] = [0, -71.113 mm, -7.428 mm].\par The position offset from HiBall sensor coordinates to the }{\b\f2\fs24 tip }{\f5\fs24 of the probe is\par [X, Y, Z] = [0, -167.335 mm, -102.808 mm].\par (These are nominal values derived from the manufacturing specifications; for\par more precise values there is a calibration procedure; contact\par }{\i\f4\fs24 support@3rdtech.com }{\f5\fs24 for details.)\par }{\b\f2 Figure 15 HiBall Stylus with Long Probe\par }{\b\f9\fs24\cf5 Communicating with stylus buttons\par }{\f5\fs24 You communicate with stylus buttons through VRPN in the same way as with\par the tracker reports. Create a }{\i\f4\fs24 vrpn_Button_Remote }{\f5\fs24 device that connects to\par “Button0@HiBall”, and register a callback for the buttons. Your callback\par function will receive a record from VRPN every time a button is pressed or\par released. The callback function should look like the following:}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 27\par }{\f5\fs24 To operate the stylus as a ‘3D object digitizer’, have your tracker callback keep\par a copy of the latest tracker report and when you get a ‘button down’ event, take\par the latest tracker report as the stylus position. This is illustrated in the sample\par application }{\i\f4\fs24 stylus}{\f5\fs24 . Note, also, that both records have timestamp information.\par You can check these if button-tracker synchronization is a concern (in an\par application with a slow main loop, for example).\par }{\b\f9\fs24\cf5 Using the stylus for digitization/measurement\par }{\f5\fs24 For measurement/digitization applications, you will typically want to use\par HiBall system settings that maximize absolute accuracy. This can be achieved\par by running the system with a saved, autocalibrated ceiling map (see Section\par 6.3) and autocalibration off (see Section 6.2.3). Note that this will provide the\par highest absolute accuracy at the expense of some of the 'smoothness' of the\par output. Applications for graphic display on monitors, projectors, or headmounted-\par displays will typically want to trade off this peak absolute accuracy\par for smoother readings by running the system with autocalibration on.\par }{\f6\fs28\cf4 4.1.6 Sample VRPN client applications\par }{\f5\fs24 Along with VRPN, sample VRPN client code is included on the HiBall client\par software CD. The binary files for these programs will run as-is on most\par Windows PCs. The source files are included, and should compile as-is under\par Windows using Microsoft Visual C++ or on other platforms with minor\par changes. They are intended to be simple enough to be modified for other\par platforms easily. Some of these programs require VRPN, OpenGL, and GLUT\par (the OpenGL Utility Toolkit). The library and include files for VRPN and\par GLUT are provided on the CD; newer versions may be available on the\par respective websites (GLUT is available from SGI at\par }{\i\f4\fs24 http://reality.sgi.com/opengl/}{\f5\fs24 ; VRPN is available at\par }{\i\f4\fs24 http://www.cs.unc.edu/Research/vrpn}{\f5\fs24 . The GL files should come with the\par compiler or the graphics card driver.\par In order to compile and link these applications, you will need to define an\par environment variable called HIBALL_ROOT that specifies the path to your\par client’s Hiball directory. The include files for VRPN, etc, are assumed to be in\par }{\f11\fs18 void handle_button(void *userdata, const vrpn_BUTTONCB b)\par \{\par // HiBall Stylus buttons:\par // b.button indicates HiBall/stylus tether\par // b.state indicates button down (1) or up (0)\par printf("Button state %d from hiball %d\\n",\par b.state, b.button);\par \}}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 28\par }{\f5\fs24 $(HIBALL_ROOT)\\include and the libraries are assumed to be in\par $(HIBALL_ROOT)\\lib\\\{Release,Debug\}, etc.\par Sample graphical applications:\par }{\f7\fs16 q  }{\i\f4\fs24 simpleApp }{\f5\fs24 – displays a wire frame representation of the room and\par coordinate axes at the tracker origin and at the origin for each HiBall.\par This demonstrates how to draw objects at the sensor positions and how\par to draw a head-tracked view.\par }{\f7\fs16 q  }{\i\f4\fs24 stylus – }{\f5\fs24 demonstrates how to use the HiBall and stylus to digitize\par points. This program displays a wire frame room (similar to that in\par simpleApp) and coordinate axes at the HiBall position. A sphere is\par drawn at the stylus tip position. Each stylus button click generates a\par marker point in the environment. Point locations are also saved to a\par file. In 'stream' mode, points are generated as long as button is held\par down.\par }{\f7\fs16 q  }{\i\f4\fs24 dials }{\f5\fs24 – this program is useful for measuring tracker performance. It\par provides graphical display of tracker reports and computes standard\par deviation of reports (to estimate noise when the HiBall sensor is kept\par still).\par Sample text-only applications:\par }{\f7\fs16 q  }{\i\f4\fs24 textApp }{\f5\fs24 – a simple application that display tracker records once every\par few seconds and button records as they happen\par }{\f7\fs16 q  }{\i\f4\fs24 record – }{\f5\fs24 this application will record tracker position and orientation\par data to a file at the VRPN update rate. The output format is as follows,\par where time is in seconds, X, Y, and Z are in meters, and Yaw, Pitch,\par Roll are in degrees:\par }{\f11\fs18 time X Y Z Yaw Pitch Roll\par }{\f5\fs24 Note: as always, you should not run these client applications on the\par HiBall server itself because it will slow down the tracker.\par (Running text-only demos on the HiBall PC may not cause serious\par problems.)\par }{\f6\fs44\cf2 5 Troubleshooting\par }{\f6\fs32\cf3 5.1 Hardware problems\par }{\f7\fs16 q  }{\b\f2\fs24 Some LEDs on the ceiling do not blink. }{\f5\fs24 If a region of the ceiling\par doesn’t appear to blink, run }{\i\f4\fs24 ledtest }{\f5\fs24 to check all LEDs; then check}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 29\par }{\f5\fs24 connections. You may need to test parts of the ceiling in small\par increments in order to isolate the strip at which the problem begins.\par }{\f7\fs16 q  }{\b\f2\fs24 HiBall server PC screen goes blank. }{\f5\fs24 Check that the screensaver is\par disabled (in the Display control panel under Settings). The screensaver\par may lock up under Windows NT while CPU-intensive programs are\par running.\par }{\f7\fs16 q  }{\b\f2\fs24 HiBall server is slow or prints multiple timeout messages. }{\f5\fs24 Check\par that no other applications are running on the server PC. You must run\par client tracker applications on other machines.\par }{\f7\fs16 q  }{\b\f2\fs24 “Out of disk space” errors on the HiBall PC. }{\f5\fs24 The HiBall PC\par requires disk space in which to store log files (typically in\par E:\\HiBall\\logs). Remove other applications from the HiBall PC – this\par machine must only run the HiBall server or the tracker will not\par function properly.\par }{\f6\fs32\cf3 5.2 Error messages\par }{\f7\fs16 q  }{\b\f2\fs24 “InitPortIO: Couldn't access giveio device” }{\f5\fs24 - Check that the parallel\par port cables are connected properly to the correct ports. Check that the\par CIB is powered on.\par }{\f7\fs16 q  }{\b\f2\fs24 “ERR_RX_TIMEOUT” or other “EPP timeout” messages }{\f5\fs24 – Check\par that the correct number of HiBall sensors is connected and that the CIB\par is powered on.\par }{\f7\fs16 q  }{\b\f2\fs24 “ERR_RX_CKSUM” or other “ERR_RX” messages. }{\f5\fs24 Check that\par parallel port cables are connected properly to the correct ports.\par }{\f6\fs32\cf3 5.3 Tracking performance\par }{\f7\fs16 q  }{\b\f2\fs24 Tracker is slow acquiring or always displays red “ACQ”. }{\f5\fs24 Try to\par keep the HiBall upright and still at head or hand height (acquisition\par will be fastest under those conditions). Check, using the IR camera and\par TV, whether any LEDs are blinking on the ceiling. If no LEDs are\par blinking, shutdown the server, power-cycle the CIB, and restart. If\par LEDs blink but the system still will not acquire, check that your ceiling\par map height (in the ceiling map file and the tracker configuration file)\par corresponds to your physical ceiling height.\par }{\f7\fs16 q  }{\b\f2\fs24 LEDs do not blink. }{\f5\fs24 If no LEDs blink when the HiBall server is\par running, power-cycle the CIB and run }{\i\f4\fs24 ledtest}{\f5\fs24 . Step through all LEDs\par to verify that they work.\par }{\f7\fs16 q  }{\b\f2\fs24 Jitter in tracker reports. }{\f5\fs24 We have found that certain lights interfere\par with HiBall performance. Try turning off lights in the environment,}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 30\par }{\f5\fs24 especially lights directly behind Beacon strips. Try the post-filtering\par tools on the VRPN control panel. We recommend exponential postfiltering\par set at 90. If the problems continue please contact 3rdTech.\par }{\f6\fs32\cf3 5.4 Support Contacts\par }{\f5\fs24 Email: support@3rdTech.com\par Phone: (919) 929-1903\par }{\f6\fs44\cf2 6 Customizing the HiBall-3000 tracker\par }{\f6\fs32\cf3 6.1 Changing the ceiling configuration\par }{\f5\fs24 The HiBall-3000 system comes with a standard ceiling map that fits your initial\par configuration. You can customize this map to your meet your requirements.\par We recommend connecting and testing the pre-configured map first before you\par make any customizations.\par Customizing the map will enable you to\par }{\f7\fs16 q  }{\f5\fs24 Skip over obstacles in the ceiling – smoke alarms, sprinklers, vents,\par etc.\par }{\f7\fs16 q  }{\f5\fs24 Change the dimensions of the ceiling (to fit into a narrower space or\par around a corner).\par The software requires Beacon strips to be laid out on an 8-inch by 24-inch grid\par (except in special cases – see Section 6.1.2). The ceiling map editor lets you\par change the order and arrangement of strips on this grid. It generates a ceiling\par map file that specifies for the HiBall server how the strips are connected.\par }{\f6\fs28\cf4 6.1.1 Running the ceiling map editor\par }{\f5\fs24 The ceiling map editor is located on your server PC in the E:\\HiBall\\bin\par directory. Run the program as follows:\par makemap -i <input file> -o <output file> -hf <ceiling height in\par feet>\par Run this program on the HiBall server PC (when the HiBall server is not\par running), or on your own client PC\par A note about arguments:\par }{\f7\fs16 q  }{\f5\fs24 You can specify the same file for both input and output.\par }{\f7\fs16 q  }{\f5\fs24 The height argument only needs to be specified if you want to change\par it; otherwise it will default to the value that’s in the input file.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 31\par }{\f7\fs16 q  }{\f5\fs24 If you specified no input file then the program will start with a 1-strip\par ceiling at 8 feet high.\par }{\f7\fs16 q  }{\f5\fs24 If you give no output file name then the program will write to\par }{\i\f4\fs24 ceiling.map }{\f5\fs24 or to the input file, if you gave one.\par }{\f7\fs16 q  }{\f5\fs24 You can specify the ceiling height in meters instead of in feet by using\par the flag ‘-hm’ rather than ‘-hf’\par To start a new map file from scratch use ‘makemap -o file.map –hf height’ – it\par will start with the default 1-strip ceiling at ‘height’ feet.\par Use the extension .}{\i\f4\fs24 map }{\f5\fs24 for ceiling map files.\par }{\b\f9\fs24\cf5 Editing and saving the ceiling map\par }{\f5\fs24 When you run this program it will bring up a graphics window and a text DOS\par window. Look in the text window for error messages and status information.\par The graphics window will appear as follows (this is the default screen when the\par program is started without an input file).}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 32\par }{\b\f2 Figure 16 Ceiling map editor.\par }{\f5\fs24 The grid indicates an array of 2 ft. x 2 ft. ceiling tiles. It represents the ceiling\par as seen from above. The green rectangle indicates a cursor position. You can\par move this cursor with the arrow keys on the keyboard.\par The workspace will adjust according to the size of the ceiling you define. 12 ft.\par x 12 ft. (6 x 6 tiles) is the minimum size. The maximum size is currently 40 ft.\par x 40 ft. (20x20 tiles). Each strip is represented by a rectangle with 8 dots inside\par it. The first dot, which is black, shows the location of the ‘In’ end of the strip.\par This is referred to here as }{\i\f4\fs24 LED 0 }{\f5\fs24 – the first LED on the strip. The other 7\par LEDs are displayed in red.\par Strips normally point left-to-right or right-to-left, on the ceiling map editor’s\par screen. To toggle this direction, press the space bar over the strip. The first\par strip must always have LED 0 in the corner (you can’t change the direction of}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 33\par }{\f5\fs24 this strip). This position defines the origin of tracker coordinates (marked with\par a large circle on the screen). (See section 4.1.3 for details on tracker coordinate\par systems.) Note that the lines indicating cables may be drawn overtop of strips\par if you have the direction reversed. Be sure to wire them in the correct manner\par (look at the dots on the ends of the strips and the strip numbers to be sure of the\par connection order).\par To add strips to a ceiling, move the cursor to the next location, and press the\par space bar to add a strip. To change that strip’s direction, press space again over\par the selected strip. Move the cursor to the next strip location and continue -\par press space to add another strip. Our convention for laying out strips is to\par continue one row lengthwise across the whole ceiling and back, etc. as shown\par in Figure 4, though you can lay the strips out differently if you prefer\par (remember that you may need new strip-to-strip cables of different lengths if\par you change the ceiling layout).\par There is a shortcut for laying out large rectangular ceilings. Move the cursor to\par the lower-left corner of the rectangular area and hit the ‘r’ key. Then move to\par the upper-right corner and hit ‘r’ again. Strips will be added to fill the\par rectangular region – make sure the connectivity is as you intended.\par Lay out your entire ceiling (108 strips for a 12 x 12 ft. ceiling). Use the ‘l’\par command to see labels on the strips. This adds a ‘bank/strip’ label next to each\par strip, which will be useful when making physical connections.\par If you have multiple banks, hit the ‘b’ key over a strip to make it the first strip\par of a new bank. The first strip of each bank is labeled, e.g. B0, B1, etc. Evennumbered\par banks will be displayed in red; odd-numbered banks will be\par displayed in blue. Keep cables in mind when you choose where to start new\par banks. Figure 15 shows a typical 3-bank installation for a 20x20 ft. ceiling (10\par rows per bank, 100 strips per bank).}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 34\par }{\b\f2 Figure 17 Typical 20 ft. x 20 ft. Ceiling Configuration as Three Banks.\par }{\f5\fs24 To delete strips from the map, hit the ‘d’ key. The editor will delete the last\par strip at the cursor position. You can delete strips from the middle of a\par rectangular region if necessary.\par }{\b\f9\fs24\cf5 Summary of editing commands\par }{\f7\fs16 q  }{\b\f2\fs24 Arrow keys – }{\f5\fs24 move cursor (green box) over strip locations\par }{\f7\fs16 q  }{\b\f2\fs24 Space (over empty location) - }{\f5\fs24 add strip at cursor\par }{\f7\fs16 q  }{\b\f2\fs24 Space (over filled location) - }{\f5\fs24 change strip direction\par }{\f7\fs16 q  }{\b\f2\fs24 d – }{\f5\fs24 delete strip at cursor}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 35\par }{\f7\fs16 q  }{\b\f2\fs24 r }{\f5\fs24 – start or end a rectangular region to be filled with strips\par }{\f7\fs16 q  }{\b\f2\fs24 b – }{\f5\fs24 bank select. Make strip at cursor start a new bank or join previous\par bank.\par }{\f7\fs16 q  }{\b\f2\fs24 l – }{\f5\fs24 display labels at strips\par }{\f7\fs16 q  }{\b\f2\fs24 R – }{\f5\fs24 reload map from input file\par }{\f7\fs16 q  }{\b\f2\fs24 s – }{\f5\fs24 save map to output file\par }{\f7\fs16 q  }{\b\f2\fs24 f – }{\f5\fs24 flip X and Y axes Necessary only for some nonstandard ceiling\par tiles – see the note below.\par }{\f7\fs16 q  }{\b\f2\fs24 Escape key – }{\f5\fs24 exit program (NOTE: this does not do a save).\par }{\f6\fs28\cf4 6.1.2 Considerations when changing the ceiling map\par }{\f7\fs16 q  }{\f5\fs24 Strips must be aligned on an 8-inch by 24-inch grid. In special cases\par you may differ from this slightly – see section 6.1.4.\par }{\f7\fs16 q  }{\f5\fs24 Note that the ‘add at cursor’ method of adding strips makes the layout\par appear more flexible than it really is. Skipping over occasional strips is\par okay, but if you skip too many the tracker will not function properly.\par The system needs a dense array of Beacon Arrays to function properly.\par The tracker will not function properly if you try to change the density\par of strips (by skipping entire rows or columns, for example).\par }{\f7\fs16 q  }{\f5\fs24 You may connect up to 255 strips per bank, and up to 8 banks. We\par recommend keeping less than 128 strips per bank unless necessary for\par a large system that requires all 8 banks.\par }{\f7\fs16 q  }{\f5\fs24 Keep cable lengths short where possible. We recommend following\par the end-to-end scheme described above.\par }{\f7\fs16 q  }{\f5\fs24 CIB-to-strip cables are different from strip-to-strip cables. Contact\par 3rdTech for additional cables.\par }{\f7\fs16 q  }{\f5\fs24 The HiBall sensor must be between 1.5 feet and 10 feet from the\par ceiling to track. When doing head tracking the ceiling height typically\par should be no lower than 8 feet and no higher than 15 feet.\par In some cases you will need to skip a strip or tile in your ceiling (to avoid a\par smoke alarm, sprinkler, or vent, for example).\par You can skip spaces in the ceiling map by placing the cursor accordingly in the\par editor, or by deleting strips from a filled region. Figure 18 shows an example\par map that skips over an entire 2 ft. x 2 ft. tile in one location, and a single strip\par in another location. Note that you may need extra strip-to-strip cables of\par different lengths if you customize your map.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 36\par }{\b\f2 Figure 18 A portion of a ceiling map showing strips deleted to avoid obstacles.\par }{\f5\fs24 Note for nonstandard ceiling tile dimensions: Ordinarily, with a 2\par ft. x 2ft. tile drop ceiling, you should start the strip rows heading to\par the right, as shown above. X is always to the right, so strips are\par along X. This will not work if you have 2 ft. x 4 ft. tiles and\par they’re oriented such that the 4 ft. space is along X (left-to-right in\par the editor) when you place the origin where you want it. In this\par case you will need to have strips going along Y (up-down in the\par editor). Use the ‘f’ (flip axes) command to do this.\par If your ceiling is not a ‘drop’ ceiling, you can mount the strips by screwing\par them into wooden or other solid frames rather than placing them under ceiling\par supports. Note that you must always be sure that strips are positioned on an 8-\par inch by 24-inch grid. The software requires this constraint for tracking.\par }{\b\f9\fs24\cf5 Power Distribution Box Location\par }{\f5\fs24 The current implementation of the ceiling map editor does not provide\par information about the number or location of PDBs. Here are some guidelines\par for locating them in custom ceiling maps. Note that these are only guidelines –\par actual placements may vary with special configurations.\par }{\f7\fs16 q  }{\f5\fs24 If a bank has 36 or fewer Beacon strips you probably do not need any\par PDBs. In this case, the CIB-to-strip cable connects directly to the first\par strip in the bank.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 37\par }{\f7\fs16 q  }{\f5\fs24 Each bank with more than 36 Beacon strips will need at least two (2)\par PDBs – one connected to the CIB and the first Beacon strip, and one\par ‘in line’ within the bank.\par }{\f7\fs16 q  }{\f5\fs24 Distribute PDBs evenly within a bank – but wiring convenience can\par also be taken into account. The goal is to have the first and last PDBs\par near each end and the inline PDBs distributed evenly as possible. See\par Figure 4 for a sample placement for 108 Beacon strips.\par }{\f7\fs16 q  }{\f5\fs24 The PDBs in a single bank get connected in a daisy chain to the first\par PDB in that bank with Power Distribution cables. They do not get\par connected to PDBs in other banks.\par If you have questions about a particular custom configuration please contact\par 3rdTech support.\par }{\b\f9\fs24\cf5 Ceiling height\par }{\f5\fs24 The height parameter defines the Z=0 point for tracker coordinates. Our\par convention is to set height equal to the height of the LEDs above the floor.\par With this convention, the tracker will return Z=0 when the HiBall is on the\par floor. The default value for ceiling height is 10 feet (3.048 m). You can leave\par the height at the default value and adjust the Z parameter in your software if\par you prefer. To change the height of a ceiling map that you’ve already created,\par run }{\i\f4\fs24 makemap }{\f5\fs24 with your new height and resave (e.g. run\par ‘}{\i\f4\fs24 makemap -i file.map -hf newHeight}{\f5\fs24 ’, hit ‘s’ to save, then quit). The new\par height should now show in the display. You can also examine the ceiling map\par file itself.\par }{\b\f2\fs24 The height value you enter in the ceiling map editor\par must match the height value in the tracker\par configuration file.\par }{\b\f9\fs24\cf5 Placing strips in the ceiling\par }{\f5\fs24 There is some tolerance in the software for error in strip placement – up to\par approximately ½ inch (1.3 cm). The software’s LED autocalibration will\par attempt to correct for this over time. Errors larger than this may not be\par corrected and will degrade performance. Remember to power off the CIB\par when changing ceiling connections.\par }{\f6\fs28\cf4 6.1.3 Enabling the new ceiling map in the tracker\par configuration file\par }{\f5\fs24 The tracker configuration file specifies which ceiling map to use. Edit the file\par to point to your new map file and edit the }{\i\f4\fs24 stripheight }{\f5\fs24 parameter if you changed}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 38\par }{\f5\fs24 the ceiling height in the map file. In the current software, the ‘stripheight’ line\par in that file must correspond to the height in the ceiling file.\par }{\f6\fs28\cf4 6.1.4 Changing the Beacon Grid Spacing\par }{\f5\fs24 If necessary for your ceiling you may alter the 8” x 24” grid spacing of Beacon\par strips. Use this functionality for minor changes only (e.g., due to metric vs.\par English units).\par }{\b\f2\fs24 Grids with spacing other than 8” x 24” have not\par been tested. Changing the beacon spacing may\par change the performance characteristics of your\par HiBall Tracker system.\par }{\f5\fs24 To change the strip spacing:\par }{\f7\fs16 q  }{\f5\fs24 In the Tracker Configuration File, change the ‘striprow’ line to specify\par the distance in meters between strip rows (normally 8 inches = 0.2032\par m). Change the ‘stripcol’ line to specify the distance in meters\par between strip columns (normally 24 inches = 0.6096 m).\par }{\f7\fs16 q  }{\f5\fs24 Change the spacing in the ceiling map file using “makemap”.\par Makemap places strips on an 8” x 24” grid by default. To change the\par grid spacing, specify the new row and column spacing on the command\par line when you execute makemap as follows (note: this is in }{\i\f4\fs24 inches}{\f5\fs24 , not\par meters).\par }{\f11 makemap -i input –o output –hf heightFeet –r stripRowInches –c\par stripColInches\par }{\b\f2\fs24 The beacon spacing and height in the Tracker\par Configuration File must match the spacing and\par height used to create the ceiling map in ‘makemap’.\par }{\f6\fs32\cf3 6.2 Customizing the HiBall Server\par }{\f6\fs28\cf4 6.2.1 Overview of configuration files\par }{\f5\fs24 The following configuration files are used in the HiBall-3000 tracker. These\par files reside in your HiBall configuration directory (typically E:\\HiBall\\config\\ -\par - see your HiBall installation information document for the exact location).\par These files are listed in a ‘top-down’ fashion – each file references only files\par below it. If you edit any file you may need to edit the files above it. Most files\par can be edited with the }{\i\f4\fs24 wordpad }{\f5\fs24 application, except where noted.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 39\par }{\f7\fs16 q  }{\b\f2\fs24 VRPN Configuration File }{\f5\fs24 (e.g. ‘vrpnC18.cfg’). This is the top-level\par configuration file for the HiBall VRPN server. It contains the VRPN\par device names for the tracker and button servers, and parameters for\par VRPN update rate, tracker filtering and prediction.\par }{\f7\fs16 q  }{\b\f2\fs24 Tracker Configuration File }{\f5\fs24 (e.g. ‘trackerC18.cfg’). This file lists the\par HiBall sensors that are connected (by their configuration files), the\par ceiling map, the ceiling height, and other details specific to the PC\par host.\par }{\f7\fs16 q  }{\b\f2\fs24 Ceiling Map File }{\f5\fs24 (e.g. ‘C18.map’). This file describes the strip\par arrangement and ceiling height. You can create or edit ceiling map\par files with }{\i\f4\fs24 makemap }{\f5\fs24 as described in Section 6.1.\par }{\f7\fs16 q  }{\b\f2\fs24 HiBall Configuration File }{\f5\fs24 (e.g. ‘hiball3009.cfg’). This file describes\par HiBall-specific configuration information. (One for each HiBall\par sensor.) }{\b\f2\fs24 DO NOT EDIT THIS FILE. }{\f5\fs24 The configuration for this\par particular HiBall Sensor was specified at the factory.\par }{\f7\fs16 q  }{\b\f2\fs24 HiBall Calibration File }{\f5\fs24 (e.g., ‘h3009dtab.mat’). Calibration tables\par (one for each HiBall sensor). }{\b\f2\fs24 DO NOT EDIT THIS FILE. }{\f5\fs24 The\par calibration tables for the specific HiBall Sensor were determined at the\par factory.\par The following sections describe common changes to the configuration files.\par }{\f6\fs28\cf4 6.2.2 Changing the HiBall Sensor arrangement\par }{\f5\fs24 If you want to add a new HiBall sensor, or change the arrangement of HiBall\par sensors (e.g., to create a configuration that uses only one HiBall instead of\par two), change the Tracker Configuration File (or create a new one). Edit the\par ‘tether’ lines in the Tracker Configuration File, e.g.\par }{\f11\fs22 tether 0 E:\\config\\hiball3009.cfg\par }{\f5\fs24 This line specifies the tether port and matching HiBall Configuration File.\par Make sure you have the correct HiBall connected to the port (check the serial\par number on the base of the HiBall). If there is more than one tether line in the\par Tracker Configuration File, the first will refer to sensor 0 in VRPN reports, and\par the second to sensor 1 in VRPN reports.\par Note that if you create a new Tracker Configuration File you will need to\par change your VRPN Configuration File to refer to it (or create a new VRPN\par Configuration File and shortcut for that Tracker Configuration).}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 40\par }{\f6\fs28\cf4 6.2.3 Changing configuration files\par }{\b\f9\fs24\cf5 Customizations to the VRPN Configuration File\par }{\f5\fs24 The VRPN Configuration File contains a line each for the VRPN tracker and\par button devices:\par }{\f11 vrpn_Tracker_Hiball Tracker0@hiball\par E:\\HiBall\\config\\trackerbeta.cfg 72 0 25 0 0 0\par vrpn_Button_Hiball Button0@hiball 1 0x378\par }{\f5\fs24 You should not change the parameters to the button line in the VRPN\par Configuration File. Some fields in the tracker line are editable. The fields in\par that line are as follows:\par }{\f7\fs16 q  }{\i\f4\fs24 ‘vrpn_Tracker_HiBall’ }{\f5\fs24 – VRPN device type (do not change this).\par }{\f7\fs16 q  }{\i\f4\fs24 ‘Tracker0@HiBall’ }{\f5\fs24 – VRPN device name (do not change this).\par }{\f7\fs16 q  }{\i\f4\fs24 Tracker Configuration File }{\f5\fs24 – the path for the file.\par }{\f7\fs16 q  }{\i\f4\fs24 Update rate (Hz) }{\f5\fs24 – the rate for sending reports from the VRPN server\par to client applications. A typical value is 72. This should be slightly\par higher than your display (or computation) rate so that you will get one\par record per frame.\par }{\f7\fs16 q  }{\i\f4\fs24 Prediction time (ms) – }{\f5\fs24 typical value is 0. Should be no more than 25.\par }{\f7\fs16 q  }{\i\f4\fs24 Averaging post-filter time (ms) }{\f5\fs24 – typical value is 20 ms.\par }{\f7\fs16 q  }{\i\f4\fs24 ‘0’ }{\f5\fs24 – this parameter is no longer used, but is retained for backwards\par compatibility – please leave it at 0.\par }{\f7\fs16 q  }{\i\f4\fs24 Median filter window (number of records, 3 to 23) }{\f5\fs24 – specifies the width\par of a median filter to apply to tracker measurements to remove outliers.\par }{\f7\fs16 q  }{\i\f4\fs24 Exponential averaging post}{\f5\fs24 -}{\i\f4\fs24 filter constant (0 to 100) – }{\f5\fs24 determines the\par degree of exponential post-filtering to be added for smoothing the\par tracker measurements.\par You can specify only one type of post-filtering or prediction. The values for\par the other filters must be zero. To apply an averaging post-filter of 20 ms, the\par last five fields would be ‘0 20 0 0 0’. To apply an exponential averaging postfilter\par with filter constant 0.95, you would use ‘0 0 0 0 95’.\par Note that some of these fields can also be changed interactively in the VRPN\par Server Control Panel while the tracker is running (see Section 4.1).\par }{\b\f9\fs24\cf5 Customizations to the Tracker Configuration File\par }{\f5\fs24 You may wish to edit the following lines in the Tracker Configuration File\par (note: all keywords should be all lower-case)}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 41\par }{\f7\fs16 q  }{\f5\fs24 tether <0|1> E:\\hiball\\config\\hiball3XXX.cfg - Choose tether ports and\par HiBall sensors (as described in previous section).\par }{\f7\fs16 q  }{\f5\fs24 autocalibrate <on|off> - Use this to turn LED position autocalibration\par on/off (see Section 6.3 for more on autocalibration).\par }{\f7\fs16 q  }{\f5\fs24 ‘logdir <path>’ - Change the path for VRPN Server log files.\par }{\f7\fs16 q  }{\f5\fs24 ‘ceilingmap <mapfile>’ - Choose a ceiling map.\par }{\f7\fs16 q  }{\f5\fs24 ‘stripheight <height>’ - Change the height of the ceiling Beacon Array.\par }{\f7\fs16 q  }{\f5\fs24 ‘striprow’ and ‘stripcol’ – see Section 6.1.4.\par }{\f7\fs16 q  }{\f5\fs24 ‘multimodel <on|off>’ – enable/disable multimodel switching (see\par Section 6.4).\par }{\f7\fs16 q  }{\f5\fs24 ‘multimodelt <vel> <buffer>’ – translational velocity and threshold for\par multimodel switching.\par }{\f7\fs16 q  }{\f5\fs24 ‘multimodelr <vel> <buffer>’ – rotational velocity and threshold for\par multimodel switching.\par }{\f6\fs32\cf3 6.3 Customizing Beacon Autocalibration\par }{\f5\fs24 The Beacon Autocalibration feature will automatically adjust for errors in strip\par position that result from how the strips are positioned initially (or even from\par motion in the ceiling during operation). Autocalibration will correct for these\par errors as you move the HiBall sensor around. Each time it views an LED, it\par improves its estimate of that LED’s position. Typically, any large errors in\par LED positions will be corrected within 30 seconds of normal tracking. Within\par 3 minutes, the system will reach its optimal estimates of LED positions and will\par henceforth make little further improvement.\par For maximum accuracy, we recommend that you run autocalibration as a\par separate procedure after installation and save a calibrated ceiling map to start\par tracking with in subsequent runs. This will allow the ceiling to begin with a\par good estimate of LED positions and will enhance accuracy during the first few\par minutes of each subsequent run. The following sections describe how to do\par this.\par }{\b\f9\fs24\cf5 Autocalibration status information\par }{\f5\fs24 The ‘Beacons’ tab on the HiBall control panel (see Figure 19) shows the status\par of autocalibration:\par }{\f7\fs16 q  }{\f5\fs24 Whether autocalibration is on or off.\par }{\f7\fs16 q  }{\f5\fs24 The number of rows and columns in the ceiling map.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 42\par }{\f7\fs16 q  }{\f5\fs24 The average ‘beacon correction factor’ across all LED beacons. This is\par an estimate of uncertainty about beacon positions. The smaller this\par number is, the more certain the system is of the beacon positions. This\par value starts at 3, and will typically decrease to less than 0.3 after 2 or 3\par minutes of tracking.\par }{\f7\fs16 q  }{\f5\fs24 The number of beacons that have not yet been seen by the tracker. The\par system can only correct beacons positions if it sees them. Thus you\par should make sure this number has decreased to zero if you are\par generating a precalibrated map.\par Click the ‘update statistics’ button to update the count of unseen beacons and\par the beacon correction factor.\par }{\b\f2 Figure 19. Beacon calibration tab in the HiBall Control Panel.\par }{\b\f9\fs24\cf5 Creating and saving a calibrated ceiling map\par }{\f5\fs24 To generated a corrected map:\par }{\f7\fs16 q  }{\f5\fs24 If you have more than one sensor, comment out the second sensor’s\par line in your }{\i\f4\fs24 Tracker Configuration File }{\f5\fs24 (described in Section 6.2.1 and\par 6.2.3) by placing a ‘#’ in front of the line that looks like: “tether 1\par E:\\hiball\\config\\hiball3xxx.cfg”.}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 43\par }{\f7\fs16 q  }{\f5\fs24 Start the server with autocalibration on and multi-model switching\par turned off (change the line in your tracker config file from ‘multimodel\par on’ to ‘multimodel off’), and the regular map file (one that was created\par by makemap or that was included in your installation files).\par }{\f7\fs16 q  }{\f5\fs24 Immediately after the server is started, walk the HiBall sensor around\par under the ceiling for several minutes (larger ceilings typically take\par longer than small ceilings). Move the sensor slowly around so that it\par can ‘see’ all of the LEDs under the ceiling. (Moving the sensor up and\par down and rotating it will help see more LEDs quickly. You can use the\par installation camera to view LEDs while you do this to get an indication\par of which LEDs are being seen.) Monitor your progress by periodically\par clicking the ‘update statistics’ button on the Beacons tab and make sure\par that the number of beacons unseen goes to zero. Continue moving the\par sensor around under the ceiling until the ‘beacon correction factor’\par goes to 0.3 or lower.\par }{\f7\fs16 q  }{\f5\fs24 When the correction factor is low enough, immediately click the ‘write\par corrected map’ button to write a new ceiling map file to the\par HiBall\\config folder. The file will be named similarly to the ceiling\par map you started with. For example, if you started with the map file\par ‘E:\\HiBall\\config\\C18.map’, the corrected map will be named\par ‘E:\\HiBall\\config\\C18.calib.h0.map’.\par }{\f7\fs16 q  }{\f5\fs24 Edit your tracker config file to turn multi-model switching and your\par second sensor (if applicable) back on.\par }{\b\f9\fs24\cf5 Starting the tracker with a pre-calibrated ceiling map\par }{\f5\fs24 To have the tracker start with the new map file you created, edit the }{\i\f4\fs24 Tracker\par Configuration File }{\f5\fs24 (described in Section 6.2.1). Change the “ceilingmap” line\par to point to the new ceiling map filename. This map will be loaded for each\par HiBall sensor. You can verify that it loads the proper file by looking at the\par ‘Configuration’ tab of the HiBall Control Panel (see Section 3.1.1).\par }{\f6\fs32\cf3 6.4 Customizing Multimodel Switching\par }{\f5\fs24 Multimodel Kalman filter switching allows the tracker to adapt to user motion.\par The tracker effectively changes the Kalman Filter ‘process model’ (or ‘plant\par model’). When the user is moving quickly, the tracker uses a ‘Position-\par Velocity’ process model, which is based on the user being in motion. When the\par user is still or moving slowly, the tracker uses a ‘Position’ process model,\par which is based on the user being still. The tracker actually runs both filters in\par parallel and takes output from the one that is most appropriate at a given time.\par Your HiBall-3000 system ships with default multimodel parameters that should\par work well with most applications. The following describes how to observe}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 44\par }{\f5\fs24 multimodel switching behavior or adjust the parameters. Multimodel\par information is presented on the ‘Multimodel’ tab of the HiBall Server Control\par Panel (see Figure 20).\par }{\b\f2 Figure 20. Multimodel tab in the HiBall Control Panel\par }{\b\f9\fs24\cf5 Multimodel state information\par }{\f5\fs24 The top of the display indicates whether multimodel switching is on or off.\par This is set in your Tracker configuration file by specifying ‘multimodel on’ or\par ‘multimodel off’. See Section 6.2 for more details on the Tracker configuration\par file format.\par Under ‘state’, the display indicates whether the system considers the HiBall\par sensor to be still or moving at the present time. While the state actually\par changes at the measurement rate (typically 1000 to 2000 Hz), the display in this\par control panel is updated slower. For testing purposes you may wish to increase\par the update rate for the control panel using the field near the bottom of the\par multimodel tab (enter a rate and click ‘Apply changes’).\par }{\b\f9\fs24\cf5 Customizing the switching behavior\par }{\f5\fs24 The tracker will switch state according to translational and rotational velocity\par thresholds. These parameters can be changed in this panel. The first number}\par {\i\f4\fs16 HiBall-3000 Tracker 1/23/02 }{\b\f2\fs18 45\par }{\f5\fs24 gives the velocity; the second number specifies a buffer to avoid hysteresis\par effects. If you wish to change the default parameters, you can edit these lines\par in your tracker configuration file. The appropriate lines are ‘multimodelt <vel>\par <buffer>’ and ‘multimodelr <vel> <buffer>’.\par }{\f6\fs32\cf3 6.5 Upgrading software\par }{\f6\fs28\cf4 6.5.1 Upgrading VRPN\par }{\f5\fs24 You can retrieve an updated version of VRPN to use with your client software\par at any time from the VRPN web page\par }{\i\f4\fs22 http://www.cs.unc.edu/Research/vrpn/}{\f5\fs24 .\par Note that the major version number of VRPN must match the major version\par number of the HiBall server. When a new major version of VRPN is released,\par you’ll be informed about a new release of HiBall software. (The current VRPN\par release is version 6.02. The next major release will be 7.0.)\par }{\f6\fs28\cf4 6.5.2 Upgrading HiBall tracker software\par }{\f5\fs24 HiBall software upgrades will be available on occasion from 3rdTech. You’ll\par be contacted when new releases are available. Please report any problems or\par suggestions to }{\i\f4\fs24 support@3rdtech.com}{\f5\fs24 .\par}\par } 